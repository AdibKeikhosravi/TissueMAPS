<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>tmlib.readers &mdash; TissueMAPS Library 0.1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../_static/tmaps_favicon.ico"/>
    <link rel="top" title="TissueMAPS Library 0.1.0 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for tmlib.readers</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">import</span> <span class="nn">ruamel.yaml</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">bioformats</span>
<span class="kn">import</span> <span class="nn">javabridge</span>
<span class="kn">from</span> <span class="nn">gi.repository</span> <span class="kn">import</span> <span class="n">Vips</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">.errors</span> <span class="kn">import</span> <span class="n">NotSupportedError</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>


<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Reader classes.</span>

<span class="sd">All readers make use of the </span>
<span class="sd">`with statement context manager &lt;https://docs.python.org/2/reference/datamodel.html#context-managers&gt;`_.</span>
<span class="sd">and follow a similar syntax::</span>

<span class="sd">    with Reader(&#39;/path/to/folder&#39;) as reader:</span>
<span class="sd">        data = reader.read(&#39;name_of_file&#39;)</span>

<span class="sd">    with Reader() as reader:</span>
<span class="sd">        data = reader.read(&#39;/path/to/file&#39;)</span>
<span class="sd">&#39;&#39;&#39;</span>


<div class="viewcode-block" id="Reader"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.Reader">[docs]</a><span class="k">class</span> <span class="nc">Reader</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Abstract reader base class.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ABCMeta</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">except_type</span><span class="p">,</span> <span class="n">except_value</span><span class="p">,</span> <span class="n">except_trace</span><span class="p">):</span>
        <span class="k">pass</span>
        <span class="c"># if except_value:</span>
        <span class="c">#     sys.stdout.write(&#39;%s\n&#39; % str(except_value))</span>
        <span class="c">#     for tb in traceback.format_tb(except_trace):</span>
        <span class="c">#         sys.stdout.write(tb)</span>

</div>
<div class="viewcode-block" id="TextReader"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.TextReader">[docs]</a><span class="k">class</span> <span class="nc">TextReader</span><span class="p">(</span><span class="n">Reader</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Abstract base class for reading text from files on disk.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ABCMeta</span>

    <span class="nd">@abstractmethod</span>
<div class="viewcode-block" id="TextReader.read"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.TextReader.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span>

</div></div>
<div class="viewcode-block" id="XmlReader"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.XmlReader">[docs]</a><span class="k">class</span> <span class="nc">XmlReader</span><span class="p">(</span><span class="n">TextReader</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initialize an object of class XmlReader.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        directory: str, optional</span>
<span class="sd">            absolute path to a directory where files are located</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">XmlReader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>

<div class="viewcode-block" id="XmlReader.read"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.XmlReader.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Read XML file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename: str</span>
<span class="sd">            path to the XML file</span>
<span class="sd">        **kwargs: dict</span>
<span class="sd">            additional arguments as key-value pairs (none implemented)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        `filename` can be provided as relative path</span>
<span class="sd">        when `directory` was set upon instantiation of the reader object.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        OSError</span>
<span class="sd">            when `filename` does not exist</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s">&#39;File does not exist: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

</div></div>
<div class="viewcode-block" id="load_json"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.load_json">[docs]</a><span class="k">def</span> <span class="nf">load_json</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert JSON string to Python object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    string: str</span>
<span class="sd">        JSON string</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict or list</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="JsonReader"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.JsonReader">[docs]</a><span class="k">class</span> <span class="nc">JsonReader</span><span class="p">(</span><span class="n">TextReader</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class for reading JSON from files on disk.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initialize an object of class JsonReader.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        directory: str, optional</span>
<span class="sd">            absolute path to a directory where files are located</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">JsonReader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>

<div class="viewcode-block" id="JsonReader.read"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.JsonReader.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Read JSON file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename: str</span>
<span class="sd">            path to the JSON file</span>
<span class="sd">        **kwargs: dict</span>
<span class="sd">            additional arguments as key-value pairs (none implemented)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict or list</span>
<span class="sd">            file content</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        `filename` can be provided as relative path</span>
<span class="sd">        when `directory` was set upon instantiation of the reader object.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        OSError</span>
<span class="sd">            when `filename` does not exist</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s">&#39;File does not exist: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">load_json</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

</div></div>
<div class="viewcode-block" id="ImageMetadataReader"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.ImageMetadataReader">[docs]</a><span class="k">class</span> <span class="nc">ImageMetadataReader</span><span class="p">(</span><span class="n">JsonReader</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class for reading image related metadata.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initialize an object of class ImageMetadataReader.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        directory: str, optional</span>
<span class="sd">            absolute path to a directory where files are located</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ImageMetadataReader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>

</div>
<div class="viewcode-block" id="load_yaml"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.load_yaml">[docs]</a><span class="k">def</span> <span class="nf">load_yaml</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">use_ruamel</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert YAML string to Python object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    string: str</span>
<span class="sd">        YAML string</span>
<span class="sd">    use_ruamel: bool, optional</span>
<span class="sd">        when the `ruamel.yaml` library should be used (defaults to ``False``)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict or list</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">use_ruamel</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ruamel</span><span class="o">.</span><span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">ruamel</span><span class="o">.</span><span class="n">yaml</span><span class="o">.</span><span class="n">RoundTripLoader</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="YamlReader"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.YamlReader">[docs]</a><span class="k">class</span> <span class="nc">YamlReader</span><span class="p">(</span><span class="n">TextReader</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class for reading YAML from files on disk.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initialize an object of class YamlReader.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        directory: str, optional</span>
<span class="sd">            absolute path to a directory where files are located</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">YamlReader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>

<div class="viewcode-block" id="YamlReader.read"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.YamlReader.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Read YAML file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename: str</span>
<span class="sd">            path to the YAML file</span>
<span class="sd">        **kwargs: dict</span>
<span class="sd">            additional arguments as key-value pairs</span>
<span class="sd">            (&quot;use_ruamel&quot;: *bool*, when `ruamel.yaml` library should be used)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict or list</span>
<span class="sd">            file content</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        `filename` can be provided as relative path</span>
<span class="sd">        when `directory` was set upon instantiation of the reader object.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        OSError</span>
<span class="sd">            when `filename` does not exist</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="s">&#39;use_ruamel&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">use_ruamel</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;use_ruamel&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">use_ruamel</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s">&#39;File does not exist: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">yaml_content</span> <span class="o">=</span> <span class="n">load_yaml</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">use_ruamel</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">yaml_content</span>

</div></div>
<div class="viewcode-block" id="UserConfigurationReader"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.UserConfigurationReader">[docs]</a><span class="k">class</span> <span class="nc">UserConfigurationReader</span><span class="p">(</span><span class="n">YamlReader</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initialize an object of class UserConfigurationReader.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        directory: str, optional</span>
<span class="sd">            absolute path to a directory where files are located</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">UserConfigurationReader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>

</div>
<div class="viewcode-block" id="DatasetReader"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.DatasetReader">[docs]</a><span class="k">class</span> <span class="nc">DatasetReader</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Base class for reading datasets and attributes from HDF5 files on disk.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initialize an instance of class DatasetReader.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename: str</span>
<span class="sd">            absolute path to an HDF5 file</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="c"># TODO: raise Exception if dataset does not exist</span>

<div class="viewcode-block" id="DatasetReader.exists"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.DatasetReader.exists">[docs]</a>    <span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check whether a `path` exists within a file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path: str</span>
<span class="sd">            absolute path to a group or dataset in the file</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            ``True`` if `path` exists and ``False`` otherwise</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
</div>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_is_dataset</span><span class="p">(</span><span class="n">element</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">h5d</span><span class="o">.</span><span class="n">DatasetID</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_is_group</span><span class="p">(</span><span class="n">element</span><span class="p">):</span>
        <span class="c"># TODO: this doesn&#39;t work, also lists datasets</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">h5g</span><span class="o">.</span><span class="n">GroupID</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>

<div class="viewcode-block" id="DatasetReader.list_dataset_names"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.DatasetReader.list_dataset_names">[docs]</a>    <span class="k">def</span> <span class="nf">list_dataset_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path: str</span>
<span class="sd">            absolute path to a group in the file</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[str]</span>
<span class="sd">            names of the datasets in `path`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_dataset</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">names</span>
</div>
<div class="viewcode-block" id="DatasetReader.list_group_names"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.DatasetReader.list_group_names">[docs]</a>    <span class="k">def</span> <span class="nf">list_group_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path: str</span>
<span class="sd">            absolute path to a group in the file</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[str]</span>
<span class="sd">            names of the groups in `path`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_dataset</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">names</span>
</div>
<div class="viewcode-block" id="DatasetReader.read"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.DatasetReader.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">row_index</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">column_index</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Read a dataset. For *fancy-indexing* see</span>
<span class="sd">        `h5py docs &lt;http://docs.h5py.org/en/latest/high/dataset.html#fancy-indexing&gt;`_.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path: str</span>
<span class="sd">            absolute path to the dataset within the file</span>
<span class="sd">        index: int or List[int], option</span>
<span class="sd">            zero-based index</span>
<span class="sd">        row_index: int or List[int], optional</span>
<span class="sd">            zero-based row index</span>
<span class="sd">        column_index: int or List[int], optional</span>
<span class="sd">            zero-based column index</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numpy.ndarray</span>
<span class="sd">            dataset</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        KeyError</span>
<span class="sd">            when `path` doesn&#39;t point to an existing dataset</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="p">[</span><span class="n">path</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&#39;Dataset does not exist: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">row_index</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">column_index</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
                    <span class="s">&#39;Dataset dimensions do not allow row-wise indexing&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">dataset</span><span class="p">[</span><span class="n">row_index</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">row_index</span> <span class="ow">and</span> <span class="n">column_index</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
                    <span class="s">&#39;Dataset dimensions do not allow column-wise indexing&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">dataset</span><span class="p">[:,</span> <span class="n">column_index</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">row_index</span> <span class="ow">and</span> <span class="n">column_index</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
                    <span class="s">&#39;Dataset dimensions do not allow row/column-wise indexing&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">dataset</span><span class="p">[</span><span class="n">row_index</span><span class="p">,</span> <span class="n">column_index</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">index</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dataset</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dataset</span><span class="p">[()]</span>
</div>
<div class="viewcode-block" id="DatasetReader.get_attribute"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.DatasetReader.get_attribute">[docs]</a>    <span class="k">def</span> <span class="nf">get_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get an attribute attached to a dataset.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path: str</span>
<span class="sd">            absolute path to the dataset within the file</span>
<span class="sd">        name: str</span>
<span class="sd">            name of the attribute</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ???</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        KeyError</span>
<span class="sd">            when `path` doesn&#39;t point to an existing dataset</span>
<span class="sd">        AttributeError</span>
<span class="sd">            when dataset does not have an attribute called `name`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="p">[</span><span class="n">path</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&#39;Dataset does not exist: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
        <span class="n">attribute</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">attribute</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                    <span class="s">&#39;Dataset does not have an attribute &quot;</span><span class="si">%s</span><span class="s">&quot;: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">attribute</span>
</div>
    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">except_type</span><span class="p">,</span> <span class="n">except_value</span><span class="p">,</span> <span class="n">except_trace</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="ImageReader"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.ImageReader">[docs]</a><span class="k">class</span> <span class="nc">ImageReader</span><span class="p">(</span><span class="n">Reader</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Abstract base class for reading images from files on disk.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ABCMeta</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initialize an object of class ImageReader.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        directory: str, optional</span>
<span class="sd">            absolute path to a directory where files are located</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ImageReader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>

    <span class="nd">@abstractmethod</span>
<div class="viewcode-block" id="ImageReader.read"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.ImageReader.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">pass</span>
</div>
    <span class="nd">@abstractmethod</span>
<div class="viewcode-block" id="ImageReader.read_subset"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.ImageReader.read_subset">[docs]</a>    <span class="k">def</span> <span class="nf">read_subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">series</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">plane</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">pass</span>

</div></div>
<div class="viewcode-block" id="SlideReader"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.SlideReader">[docs]</a><span class="k">class</span> <span class="nc">SlideReader</span><span class="p">(</span><span class="n">Reader</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Abstract base class for reading whole slide images from files on disk.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ABCMeta</span>

    <span class="nd">@abstractmethod</span>
<div class="viewcode-block" id="SlideReader.read"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.SlideReader.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">pass</span>
</div>
    <span class="nd">@abstractmethod</span>
<div class="viewcode-block" id="SlideReader.split"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.SlideReader.split">[docs]</a>    <span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

</div></div>
<div class="viewcode-block" id="BioformatsImageReader"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.BioformatsImageReader">[docs]</a><span class="k">class</span> <span class="nc">BioformatsImageReader</span><span class="p">(</span><span class="n">ImageReader</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class for reading images using the</span>
<span class="sd">    `Bio-Formats &lt;http://www.openmicroscopy.org/site/products/bio-formats&gt;`_</span>
<span class="sd">    library.</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    Requires a running Java Virtual Machine (VM). This is achieved via the</span>
<span class="sd">    `javabridge &lt;http://pythonhosted.org/javabridge/start_kill.html&gt;`_</span>
<span class="sd">    package.</span>

<span class="sd">    Warning</span>
<span class="sd">    -------</span>
<span class="sd">    Once the VM is killed it cannot be started again. This means that a second</span>
<span class="sd">    call of this class will fail.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; filename = &#39;/path/to/image/file&#39;</span>
<span class="sd">    &gt;&gt;&gt; with BioformatsImageReader() as reader:</span>
<span class="sd">    ...     img = reader.read(filename)</span>
<span class="sd">    &gt;&gt;&gt; type(img)</span>
<span class="sd">    numpy.ndarray</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initialize an object of class BioformatsImageReader.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        directory: str, optional</span>
<span class="sd">            absolute path to a directory where files are located</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BioformatsImageReader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># NOTE: updated &quot;loci_tools.jar&quot; file to latest schema:</span>
        <span class="c"># http://downloads.openmicroscopy.org/bio-formats/5.1.3</span>
        <span class="n">javabridge</span><span class="o">.</span><span class="n">start_vm</span><span class="p">(</span><span class="n">class_path</span><span class="o">=</span><span class="n">bioformats</span><span class="o">.</span><span class="n">JARS</span><span class="p">,</span> <span class="n">run_headless</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="BioformatsImageReader.read"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.BioformatsImageReader.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Read an image from a file on disk.</span>

<span class="sd">        For details on reading images via Bio-Format from Python, see</span>
<span class="sd">        `load_image() &lt;http://pythonhosted.org/python-bioformats/#reading-images&gt;`_.</span>

<span class="sd">        Unfortunately, the documentation is very sparse and sometimes wrong.</span>
<span class="sd">        If you need additional information, refer to the relevant</span>
<span class="sd">        `source code &lt;https://github.com/CellProfiler/python-bioformats/blob/master/bioformats/formatreader.py&gt;`_.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename: str</span>
<span class="sd">            absolute path to the image file</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        OSError</span>
<span class="sd">            when `filename` does not exist</span>
<span class="sd">        NotSupportedError</span>
<span class="sd">            when the file format is not supported by the reader</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numpy.ndarray</span>
<span class="sd">            pixel array</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s">&#39;Image file does not exist: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">bioformats</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">rescale</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image</span>
</div>
<div class="viewcode-block" id="BioformatsImageReader.read_subset"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.BioformatsImageReader.read_subset">[docs]</a>    <span class="k">def</span> <span class="nf">read_subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">series</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">plane</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Read a subset of images from a file on disk.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename: str</span>
<span class="sd">            absolute path to the image file</span>
<span class="sd">        series: int, optional</span>
<span class="sd">            zero-based series index</span>
<span class="sd">            (only relevant if the file contains more than one *Image* elements)</span>
<span class="sd">        plane: int, optional</span>
<span class="sd">            zero-based plane index within a series</span>
<span class="sd">            (only relevant if *Image* elements within the file contain </span>
<span class="sd">             more than one *Plane* element)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numpy.ndarray</span>
<span class="sd">            2D pixel array</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        OSError</span>
<span class="sd">            when `filename` does not exist</span>
<span class="sd">        NotSupportedError</span>
<span class="sd">            when the file format is not supported by the reader</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;read data from file: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s">&#39;Image file does not exist: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">bioformats</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">rescale</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                      <span class="n">series</span><span class="o">=</span><span class="n">series</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">plane</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image</span>
</div>
    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">except_type</span><span class="p">,</span> <span class="n">except_value</span><span class="p">,</span> <span class="n">except_trace</span><span class="p">):</span>
        <span class="n">javabridge</span><span class="o">.</span><span class="n">kill_vm</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">except_type</span> <span class="ow">is</span> <span class="n">javabridge</span><span class="o">.</span><span class="n">JavaException</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotSupportedError</span><span class="p">(</span><span class="s">&#39;File format is not supported.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">except_value</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;The following error occurred:</span><span class="se">\n</span><span class="si">%s</span><span class="s">&#39;</span>
                             <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">except_value</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">tb</span> <span class="ow">in</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_tb</span><span class="p">(</span><span class="n">except_trace</span><span class="p">):</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="NumpyImageReader"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.NumpyImageReader">[docs]</a><span class="k">class</span> <span class="nc">NumpyImageReader</span><span class="p">(</span><span class="n">ImageReader</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class for reading images from files on disk as numpy arrays.</span>

<span class="sd">    Uses the `OpenCV &lt;http://docs.opencv.org&gt;`_ library.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; filename = &#39;/path/to/image/file&#39;</span>
<span class="sd">    &gt;&gt;&gt; with NumpyImageReader() as reader:</span>
<span class="sd">    ...     img = reader.read(filename)</span>
<span class="sd">    &gt;&gt;&gt; type(img)</span>
<span class="sd">    numpy.ndarray</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initialize an object of class NumpyImageReader.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        directory: str, optional</span>
<span class="sd">            absolute path to a directory where files are located</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NumpyImageReader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>

<div class="viewcode-block" id="NumpyImageReader.read"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.NumpyImageReader.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Read an image from file on disk.</span>

<span class="sd">        For details on reading image via OpenCV from Python, see</span>
<span class="sd">        `imread() &lt;http://docs.opencv.org/modules/highgui/doc/reading_and_writing_images_and_video.html#imread&gt;`_</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename: str</span>
<span class="sd">            absolute path to the file</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numpy.array</span>
<span class="sd">            image pixel array</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        OSError</span>
<span class="sd">            when `filename` does not exist</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s">&#39;Image file does not exist: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_UNCHANGED</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image</span>
</div>
<div class="viewcode-block" id="NumpyImageReader.read_subset"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.NumpyImageReader.read_subset">[docs]</a>    <span class="k">def</span> <span class="nf">read_subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">series</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">plane</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        If the image file contains more than one plane (band), only the first</span>
<span class="sd">        one will be read.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> doesn</span><span class="se">\&#39;</span><span class="s">t have a &quot;read_subset&quot; method&#39;</span>
                             <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="VipsImageReader"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.VipsImageReader">[docs]</a><span class="k">class</span> <span class="nc">VipsImageReader</span><span class="p">(</span><span class="n">ImageReader</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class for reading images from files on disk as Vips images.</span>

<span class="sd">    Uses the</span>
<span class="sd">    `Vips &lt;http://www.vips.ecs.soton.ac.uk/index.php?title=Libvips&gt;`_ library.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; filename = &#39;/path/to/image/file&#39;</span>
<span class="sd">    &gt;&gt;&gt; with VipsReader() as reader:</span>
<span class="sd">    ...     img = reader.read(filename)</span>
<span class="sd">    &gt;&gt;&gt; type(img)</span>
<span class="sd">    Vips.Image</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initialize an object of class VipsImageReader.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        directory: str, optional</span>
<span class="sd">            absolute path to a directory where files are located</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">VipsImageReader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>

<div class="viewcode-block" id="VipsImageReader.read"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.VipsImageReader.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Read an image from file on disk.</span>

<span class="sd">        For details on reading images via VIPS from Python, see</span>
<span class="sd">        `new_from_file() &lt;http://www.vips.ecs.soton.ac.uk/supported/current/doc/html/libvips/using-from-python.html&gt;`_</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename: str</span>
<span class="sd">            absolute path to the file</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Vips.Image</span>
<span class="sd">            image pixel array</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        OSError</span>
<span class="sd">            when `filename` does not exist</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s">&#39;Image file does not exist: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">Vips</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">new_from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image</span>
</div>
<div class="viewcode-block" id="VipsImageReader.read_subset"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.VipsImageReader.read_subset">[docs]</a>    <span class="k">def</span> <span class="nf">read_subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">series</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">plane</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> doesn</span><span class="se">\&#39;</span><span class="s">t have a &quot;read_subset&quot; method. &#39;</span>
                             <span class="s">&#39;If the file contains more than one plane/band, &#39;</span>
                             <span class="s">&#39;only the first one will be read.&#39;</span>
                             <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="OpenslideImageReader"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.OpenslideImageReader">[docs]</a><span class="k">class</span> <span class="nc">OpenslideImageReader</span><span class="p">(</span><span class="n">SlideReader</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class for reading whole slide images and associated metadata using the</span>
<span class="sd">    `Openslide &lt;http://openslide.org/&gt;`_ library.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    NotSupportedError</span>
<span class="sd">        when the file format is not supported by the reader</span>

<span class="sd">    Warning</span>
<span class="sd">    -------</span>
<span class="sd">    `Openslide` doesn&#39;t support fluorescence slides.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; filename = &#39;/path/to/image/file&#39;</span>
<span class="sd">    &gt;&gt;&gt; with OpenslideReader() as reader:</span>
<span class="sd">    ...     img = reader.read(filename)</span>
<span class="sd">    &gt;&gt;&gt; type(img)</span>
<span class="sd">    Vips.Image</span>
<span class="sd">    &#39;&#39;&#39;</span>

<div class="viewcode-block" id="OpenslideImageReader.read"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.OpenslideImageReader.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Read highest resolution level of a whole slide image from disk.</span>

<span class="sd">        For details on reading whole slide images via Vips from Python, see</span>
<span class="sd">        `vips_openslideload() &lt;http://www.vips.ecs.soton.ac.uk/supported/current/doc/html/libvips/VipsForeignSave.html#vips-openslideload&gt;`_.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename: str</span>
<span class="sd">            absolute path to the file</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Vips.Image</span>
<span class="sd">            image pixel array</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">Vips</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">openslideload</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image</span>
</div>
<div class="viewcode-block" id="OpenslideImageReader.read_subset"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.OpenslideImageReader.read_subset">[docs]</a>    <span class="k">def</span> <span class="nf">read_subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">series_index</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">plane_index</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> doesn</span><span class="se">\&#39;</span><span class="s">t have a &quot;read_subset&quot; method. &#39;</span>
                             <span class="s">&#39;If the file contains more than one plane/band, &#39;</span>
                             <span class="s">&#39;only the first one will be read.&#39;</span>
                             <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="WorkflowDescriptionReader"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.WorkflowDescriptionReader">[docs]</a><span class="k">class</span> <span class="nc">WorkflowDescriptionReader</span><span class="p">(</span><span class="n">TextReader</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initialize an object of class WorkflowDescriptionReader.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        directory: str, optional</span>
<span class="sd">            absolute path to a directory where files are located</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">WorkflowDescriptionReader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>

<div class="viewcode-block" id="WorkflowDescriptionReader.read"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.WorkflowDescriptionReader.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename: str</span>
<span class="sd">            path to the YAML file</span>
<span class="sd">        **kwargs: dict</span>
<span class="sd">            additional arguments</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            file content line by line</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        `filename` can be provided as relative path</span>
<span class="sd">        when `directory` was set upon instantiation of the reader object.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s">&#39;File does not exist: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;filter file content: remove lines that begin with &quot;#&quot;&#39;</span><span class="p">)</span>
        <span class="n">filtered_content</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">filtered_content</span>

</div></div>
<div class="viewcode-block" id="MetadataReader"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.MetadataReader">[docs]</a><span class="k">class</span> <span class="nc">MetadataReader</span><span class="p">(</span><span class="n">Reader</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Abstract base class for reading metadata from additional (non-image) files.</span>

<span class="sd">    They return metadata as OMEXML objects, according to the OME data model,</span>
<span class="sd">    see `python-bioformats &lt;http://pythonhosted.org/python-bioformats/#metadata&gt;`_.</span>

<span class="sd">    Unfortunately, the documentation is very sparse.</span>
<span class="sd">    If you need additional information, refer to the relevant</span>
<span class="sd">    `source code &lt;https://github.com/CellProfiler/python-bioformats/blob/master/bioformats/omexml.py&gt;`_.</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    In case custom readers provide a *Plate* element, they also have to specify</span>
<span class="sd">    an *ImageRef* elements for each *WellSample* element, which serve as</span>
<span class="sd">    references to OME *Image* elements. Each *ImageRef* attribute must be a</span>
<span class="sd">    dictionary with a single entry. The value must be a list of strings, where</span>
<span class="sd">    each element represents the reference information that can be used to map</span>
<span class="sd">    the *WellSample* element to an individual *Image* element. The key must be</span>
<span class="sd">    a regular expression string that can be used to extract the reference</span>
<span class="sd">    information from the corresponding image filenames.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ABCMeta</span>

    <span class="nd">@abstractmethod</span>
<div class="viewcode-block" id="MetadataReader.read"><a class="viewcode-back" href="../../tmlib.html#tmlib.readers.MetadataReader.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">pass</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/tmaps_logo.png" alt="Logo"/>
            </a></p><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Markus D. Herrmann, Robin Hafen.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
    </div>

    

    
  </body>
</html>