<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>API reference &mdash; TissueMAPS Library 0.1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="_static/tmaps_favicon.ico"/>
    <link rel="top" title="TissueMAPS Library 0.1.0 documentation" href="index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="api-reference">
<span id="id1"></span><h1>API reference<a class="headerlink" href="#api-reference" title="Permalink to this headline">¶</a></h1>
<div class="section" id="metaextract">
<span id="id2"></span><h2>metaextract<a class="headerlink" href="#metaextract" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="metaconvert">
<span id="id3"></span><h2>metaconvert<a class="headerlink" href="#metaconvert" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="imextract">
<span id="id4"></span><h2>imextract<a class="headerlink" href="#imextract" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="align">
<span id="id5"></span><h2>align<a class="headerlink" href="#align" title="Permalink to this headline">¶</a></h2>
<div class="section" id="command-line-interface">
<h3>Command line interface<a class="headerlink" href="#command-line-interface" title="Permalink to this headline">¶</a></h3>
<p>Align images of the same sample acquired at different time points (i.e. in different &#8220;cycles&#8221;), which may be shifted in y, x direction relative to each other (same scale and no rotation!).</p>
<p>For help, do</p>
<div class="code highlight-python"><div class="highlight"><pre>$ align -h
</pre></div>
</div>
<p>Positional arguments:</p>
<ul class="simple">
<li><strong>run</strong>: run shift calculation</li>
<li><strong>joblist</strong>: create a joblist YAML file for parallel processing</li>
<li><strong>submit</strong>: submit jobs for parallel shift calculation</li>
<li><strong>fuse</strong>: fuse calculated shift and overlap values, and create the shift descriptor JSON file</li>
<li><strong>apply</strong>: apply calculated shifts and overlaps stored in shift descriptor to images in order to align (i.e. crop) them</li>
</ul>
</div>
<div class="section" id="image-registration">
<span id="id6"></span><h3>Image registration<a class="headerlink" href="#image-registration" title="Permalink to this headline">¶</a></h3>
<p>The information required for alignment is generated in two steps:</p>
<ol class="arabic simple">
<li><strong>Image registration</strong>: calculate shift of an image relative to a reference image (<em>run</em> step)</li>
<li><strong>Overlap calculation</strong>: calculate global overlap of images after shifting (<em>fuse</em> step)</li>
</ol>
<p>You can define which channel <code class="docutils literal"><span class="pre">--ref_channel</span></code> and cycle <code class="docutils literal"><span class="pre">--ref_cycle</span></code> should be used as a reference for image registration.</p>
<p>The reference channel must be present in all <em>cycles</em>. The reference cycle should be the one used for image segmentation.</p>
<p>The resulting values and additional metainformation are stored in a <a class="reference internal" href="#shift-descriptor">shift-descriptor</a> file in JSON format.</p>
</div>
<div class="section" id="shift-descriptor">
<span id="id7"></span><h3>Shift descriptor<a class="headerlink" href="#shift-descriptor" title="Permalink to this headline">¶</a></h3>
<p>Calculated shift and overlap values are stored together with additional metainformation in <strong>shiftDescriptor.json</strong> files in JSON format. Each file contains the following key-value pairs:</p>
<div class="code highlight-python"><div class="highlight"><pre><span class="p">{</span>
    <span class="s">&quot;xShift&quot;</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="s">&quot;yShift&quot;</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="s">&quot;fileName&quot;</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="s">&quot;lowerOverlap&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="s">&quot;upperOverlap&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="s">&quot;rightOverlap&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="s">&quot;leftOverlap&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="s">&quot;maxShift&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="s">&quot;noShiftIndex&quot;</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
    <span class="s">&quot;noShiftCount&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="s">&quot;segmentationDirectory&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="s">&quot;segmentationFileNameTrunk&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="s">&quot;cycleNum&quot;</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>xShift</strong>: A positive value means that the image is shifted to the right with respect to its reference image, while a negative value indicates a shift to the left. The unit is pixels.</p>
<p><strong>yShift</strong>: A positive value means that the image is shifted downwards with respect to its reference image, while a negative value indicates an upwards shift. The unit is pixels.</p>
<p><strong>fileName</strong>: The name of the image that was used as a reference upon registration.</p>
<p><strong>noShiftIndex</strong>: true if the maximally tolerated shift value exceeded the actual shift value at this image site, false otherwise. This can for example happen in case of empty images. By default the <strong>maxShift</strong> value is set to 100 to avoid arbitrary large shifts at empty sites. You can overwrite this behavior and change the value using the <code class="docutils literal"><span class="pre">-m</span></code> or <code class="docutils literal"><span class="pre">--max_shift</span></code> argument.</p>
<p><strong>segmentationDirectory</strong>: Relative path to the folder holding the segmentation images. By default this assumes that you want to use the shift description files for alignment in Jterator modules and sets the path relative to a Jterator project. You can overwrite this behavior and change the path using the <code class="docutils literal"><span class="pre">--segm_dir</span></code> command.</p>
<p><strong>segmentationFileNameTrunk</strong>: The first part of the filename all image files of the same cycle have in common. This may be required for regular expressions operations. You can define this string using the <code class="docutils literal"><span class="pre">--segm_trunk</span></code> argument.</p>
</div>
</div>
<div class="section" id="corilla">
<span id="id8"></span><h2>corilla<a class="headerlink" href="#corilla" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id9">
<h3>Command line interface<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>Calculate and apply statistics for <strong>COR</strong>ecting <strong>ILL</strong>umination <strong>A</strong>rtifacts in fluorescence microscopy images as described in <a class="reference internal" href="#id10">[1]</a>. It uses an online algorithm based on Welford&#8217;s method <a class="reference internal" href="#id11">[2]</a> for the calculation of mean and standard deviation at each pixel position across a large set of images.</p>
<p>For help, do</p>
<div class="code highlight-python"><div class="highlight"><pre>$ corilla -h
</pre></div>
</div>
<p>Positional arguments:</p>
<ul class="simple">
<li><strong>run</strong>: run statistics calculation</li>
<li><strong>submit</strong>: submit jobs for parallel calculation</li>
<li><strong>apply</strong>: apply calculated statistics to images in order to correct them for illumination artifacts</li>
</ul>
</div>
<div class="section" id="output">
<h3>Output<a class="headerlink" href="#output" title="Permalink to this headline">¶</a></h3>
<p>Mean and standard deviation matrices are stored in an HDF5 file per channel.
The name of this file is defined in the configuration settings in <cite>tmlib.cfg</cite>.</p>
<p>Internally the HDF5 file is structured as follows:</p>
<div class="code highlight-python"><div class="highlight"><pre>/
/data                               Group
/data/mean                          Dataset {p, q}         :: DOUBLE
/data/std                           Dataset {p, q}         :: DOUBLE
/metadata                           Group
/metadata/channel                   Dataset {1}            :: STRING
/metadata/std                       Dataset {1}            :: STRING
</pre></div>
</div>
</div>
<div class="section" id="references">
<h3>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h3>
<p id="id10">[1] Stoeger T, Battich N, Herrmann MD, Yakimovich Y, Pelkmans L. 2015. &#8220;Computer vision for image-based transcriptomics&#8221;. Methods.</p>
<p id="id11">[2] Welford BP. 1962. &#8220;Note on a method for calculating corrected sums of squares and products&#8221;. Technometrics.</p>
</div>
</div>
<div class="section" id="jterator">
<span id="id12"></span><h2>jterator<a class="headerlink" href="#jterator" title="Permalink to this headline">¶</a></h2>
<p>The <em>collect</em> step collects segmentations and measurements data created by individual jobs and fuses them into a single HDF5 file.</p>
<p>The final <code class="docutils literal"><span class="pre">data.h5</span></code> file is structured as follows:</p>
<div class="code highlight-python"><div class="highlight"><pre>/

/objects                                    Group
/objects/cells                              Group

/objects/cells                              Group
/objects/cells/ids                          Dataset {n}      :: INTEGER 32
/objects/cells/parent_ids                   Dataset {n}      :: INTEGER 32
/objects/cells/is_border                    Dataset {n}      :: BOOL
/objects/cells/is_discarded                 Dataset {n}      :: BOOL
/objects/cells/features                     Dataset {n, p}   :: FLOAT

/objects/cells/segmentations                Group
/objects/cells/segmentations/outlines       Group
/objects/cells/segmentations/outlines/y     Dataset {n}      :: VARIABLE-LENGTH INTEGER 64
/objects/cells/segmentations/outlines/x     Dataset {n}      :: VARIABLE-LENGTH INTEGER 64
/objects/cells/segmentations/centroids      Group
/objects/cells/segmentations/centroids/y    Dataset {n}
/objects/cells/segmentations/centroids/x    Dataset {n}
</pre></div>
</div>
<p>where <em>n</em> is the number of objects, <em>m</em> is the maximal number of pixels along the perimeter of objects, and <em>p</em> is the number of features measured per object. The object names &#8220;cells&#8221; and &#8220;nuclei&#8221; only serve as an example here.</p>
</div>
<div class="section" id="illuminati">
<span id="id13"></span><h2>illuminati<a class="headerlink" href="#illuminati" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id14">
<h3>Command line interface<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<p>Create pyramids in <a class="reference external" href="http://www.zoomify.com/">zoomify</a> format. In addition, it can be used to perform several custom image processing tasks, such as correcting images for illumination artifacts, shifting images for alignment between cycles, and rescaling images for convenient display.</p>
<p>For help, do</p>
<div class="code highlight-python"><div class="highlight"><pre>$ il -h
</pre></div>
</div>
<p>Positional arguments:</p>
<ul class="simple">
<li><strong>channel</strong>: create &#8220;channel&#8221; layers</li>
<li><strong>mask</strong>: create &#8220;mask&#8221; layers</li>
<li><strong>lut</strong>: create ID lookup tables</li>
</ul>
</div>
<div class="section" id="creating-channel-layers">
<h3>Creating channel layers<a class="headerlink" href="#creating-channel-layers" title="Permalink to this headline">¶</a></h3>
<p>Illuminati allows you to create pyramid images and apply different pre-processing routines &#8220;on-the-fly&#8221;, without having to save intermediate steps to disk.</p>
<p>For example, in order to create a channel layer corrected for illumination and thresholded for rescaling, do</p>
<div class="code highlight-python"><div class="highlight"><pre>$ il channel -n [channel_number] -it [project_dir]
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">-n</span></code> or <code class="docutils literal"><span class="pre">--channel_nr</span></code> argument is required to select the subset of images belonging to the same channel, in this example all images of channel 1.</p>
<p>The <code class="docutils literal"><span class="pre">-i</span></code> or <code class="docutils literal"><span class="pre">--illum_correct</span></code> argument indicates that images should be  correction for illumination artifacts.</p>
<p>The <code class="docutils literal"><span class="pre">-t</span></code> or <code class="docutils literal"><span class="pre">--thresh</span></code> argument indicates that images should be thresholded for rescaling. By default, the threshold level will be the 99.99th percentile calculated on 10 randomly sampled images. You can overwrite these defaults, by either setting different parameters for the threshold level calculation using the <code class="docutils literal"><span class="pre">--thresh_percent</span></code> and <code class="docutils literal"><span class="pre">--thresh_sample</span></code> arguments or by manually setting the threshold level using the <code class="docutils literal"><span class="pre">--thresh_value</span></code> argument.</p>
<p>If you want to run a custom project, i.e. if your project layout deviates from the default <a href="#id17"><span class="problematic" id="id18">`configuration`_</span></a>, you can create a custom configuration file and make it available to the program using the <code class="docutils literal"><span class="pre">-c</span></code> or <code class="docutils literal"><span class="pre">--config</span></code> argument</p>
<div class="code highlight-python"><div class="highlight"><pre>$ il channel -n [channel_number] -it -c [config_filename] [project_dir]
</pre></div>
</div>
<p>Output directories for the different types of pyramids are dynamically determined from the <a href="#id19"><span class="problematic" id="id20">`configuration`_</span></a> settings. However, you can also specify a different output directory using the <code class="docutils literal"><span class="pre">-o</span></code> or <code class="docutils literal"><span class="pre">--output</span></code> argument</p>
<div class="code highlight-python"><div class="highlight"><pre>$ il channel -n [channel_nr] -it -o [output_dir] [project_dir]
</pre></div>
</div>
<p>If you want the program to only create the stitched mosaic image (without creating a pyramid) you can use the <code class="docutils literal"><span class="pre">--stitch_only</span></code> argument</p>
<div class="code highlight-python"><div class="highlight"><pre>$ il channel -n [channel_nr] -it --stitch_only -o [output_dir] [project_dir]
</pre></div>
</div>
<p>In this case you have to explicitly provide the path to the output directory!</p>
</div>
<div class="section" id="creating-mask-layers">
<h3>Creating mask layers<a class="headerlink" href="#creating-mask-layers" title="Permalink to this headline">¶</a></h3>
<p>To create a pyramid image of objects outlines from individual segmentation images, do</p>
<div class="code highlight-python"><div class="highlight"><pre>$ il mask -n [objects_name] [project_dir]
</pre></div>
</div>
<p>If you rather want to build a pyramid of the whole objects area use the <code class="docutils literal"><span class="pre">-m</span></code> or <code class="docutils literal"><span class="pre">--mask</span></code> argument with &#8220;area&#8221;</p>
<div class="code highlight-python"><div class="highlight"><pre>$ il mask -n [objects_name] -m area [project_dir]
</pre></div>
</div>
<p>Creating global cell id layer:</p>
<p>This layer is not for direct visualization. It is rather used for &#8220;on-the-fly&#8221; colorization with the values returned by tools, such as the labels of a classifier. To create such a layer use the <code class="docutils literal"><span class="pre">-g</span></code> or <code class="docutils literal"><span class="pre">--global_ids</span></code> argument</p>
<div class="code highlight-python"><div class="highlight"><pre>$ il mask -n [objects_name] -m area -g [project_dir]
</pre></div>
</div>
<p>This creates a 16bit RGB pyramid in PNG format!</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Don&#8217;t use these pyramids for display in the browser! They will be automatically converted to 8bit, which will result in loss of information.</p>
</div>
</div>
<div class="section" id="creating-id-lookup-tables">
<h3>Creating ID lookup tables<a class="headerlink" href="#creating-id-lookup-tables" title="Permalink to this headline">¶</a></h3>
<p>These files are required to identify the ID of an object, when the user clicks on a pixel on the mask belonging to that object. They represent int32 <a href="#id15"><span class="problematic" id="id16">`</span></a>numpy`arrays and are named after the corresponding segmentation files.</p>
<div class="code highlight-python"><div class="highlight"><pre>$ il lut -n [objects_name] [project_dir]
</pre></div>
</div>
</div>
<div class="section" id="configuration-settings">
<h3>Configuration settings<a class="headerlink" href="#configuration-settings" title="Permalink to this headline">¶</a></h3>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/tmaps_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">API reference</a><ul>
<li><a class="reference internal" href="#metaextract">metaextract</a></li>
<li><a class="reference internal" href="#metaconvert">metaconvert</a></li>
<li><a class="reference internal" href="#imextract">imextract</a></li>
<li><a class="reference internal" href="#align">align</a><ul>
<li><a class="reference internal" href="#command-line-interface">Command line interface</a></li>
<li><a class="reference internal" href="#image-registration">Image registration</a></li>
<li><a class="reference internal" href="#shift-descriptor">Shift descriptor</a></li>
</ul>
</li>
<li><a class="reference internal" href="#corilla">corilla</a><ul>
<li><a class="reference internal" href="#id9">Command line interface</a></li>
<li><a class="reference internal" href="#output">Output</a></li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li><a class="reference internal" href="#jterator">jterator</a></li>
<li><a class="reference internal" href="#illuminati">illuminati</a><ul>
<li><a class="reference internal" href="#id14">Command line interface</a></li>
<li><a class="reference internal" href="#creating-channel-layers">Creating channel layers</a></li>
<li><a class="reference internal" href="#creating-mask-layers">Creating mask layers</a></li>
<li><a class="reference internal" href="#creating-id-lookup-tables">Creating ID lookup tables</a></li>
<li><a class="reference internal" href="#configuration-settings">Configuration settings</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/api_reference.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Markus D. Herrmann, Robin Hafen.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
      |
      <a href="_sources/api_reference.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>