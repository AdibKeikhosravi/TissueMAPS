<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Introduction &mdash; TissueMAPS Library 0.1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="_static/tmaps_favicon.ico"/>
    <link rel="top" title="TissueMAPS Library 0.1.0 documentation" href="index.html" />
    <link rel="next" title="Installation" href="installation.html" />
    <link rel="prev" title="Welcome to the documentation for the TissueMAPS Library!" href="index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="introduction">
<span id="id1"></span><h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<p><cite>TissueMAPS</cite> is a web-based, cluster-integrated tool for the visualization and analysis of large-scale 2D image datasets.</p>
<p>Microscopy datasets can easily amount to several terabytes of size, which makes it infeasible to store and process them on a local computer. Instead, we store image files on a remote data volume and process them using cluster computing.</p>
<p><cite>TissueMAPS</cite> runs on a virtual machine (<em>VM</em>) within a cloud, where it has access to a files system and a cluster computing infrastructure. Users interact with the program via the Internet.</p>
<a class="reference internal image-reference" href="_images/TissueMAPS_overview.png"><img alt="_images/TissueMAPS_overview.png" src="_images/TissueMAPS_overview.png" style="height: 500px;" /></a>
<p>The web-based approach has the advantage that no specialized software has to be installed locally and that large datasets can be handled efficiently and conveniently from a laptop computer via a standard web browser.</p>
<p>Automated configuration and installation procedures make it easy to deploy the <em>VM</em> image in different virtual environments. This can be useful for development, debugging and testing purposes.</p>
<p>The <cite>tmlib</cite> Python package serves as a library for image storage and processing routines. The library has an object-orientated design and provides classes for file system operations and interaction with the computer cluster.</p>
<p>The organizational unit of <cite>TissueMAPS</cite> is an <strong>Experiment</strong>, which is represented by a directory on disk that holds the microscopic image files and related files for metadata, calculated statistics or extracted features, for example.</p>
<div class="section" id="file-system-configuration">
<span id="id2"></span><h2>File system configuration<a class="headerlink" href="#file-system-configuration" title="Permalink to this headline">¶</a></h2>
<p>Images as well as metadata are stored in files on the file system.</p>
<div class="section" id="config-file">
<span id="id3"></span><h3>Config file<a class="headerlink" href="#config-file" title="Permalink to this headline">¶</a></h3>
<p>The layout of the directory tree on disk is configured via the <cite>cfg.py</cite> file where Python <a class="reference external" href="https://docs.python.org/2/library/string.html#formatstrings">format strings</a> are used to set paths and filenames:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">TISSUEMAPS LIBRARY CONFIGURATION SETTINGS</span>

<span class="sd">Describe the experimental layout (directory structure and filename nomenclature)</span>
<span class="sd">by Python format strings. To this end, the following keywords are available::</span>

<span class="sd">* *experiment_dir*: Absolute path to the experiment folder (string).</span>

<span class="sd">* *experiment*: Name of the experiment folder, i.e. the basename of &quot;experiment_dir&quot; (string).</span>
<span class="sd">                 </span>
<span class="sd">* *cycle_dir*: Absolute path to the cycle directory (string).</span>

<span class="sd">* *cycle*: Name of the cycle folder, i.e. the basename of &quot;cycle_dir&quot; (string).</span>

<span class="sd">* *channel*: Name of the corresponding channel or wavelength (string).</span>

<span class="sd">* *site*: One-based position index in the acquisition sequence in x, y dimensions (integer).</span>

<span class="sd">* *time*: One-based time point index in the acquisition sequence in t dimension (integer).</span>

<span class="sd">* *zstack*: One-based z-stack index in the acquisition sequence in z dimension (integer).</span>

<span class="sd">* *row*: Y index position of the image in the acquisition grid (integer).</span>

<span class="sd">* *column*: X index position of the image in the acquisition grid (integer).</span>

<span class="sd">* *well*: Well identifier Id encoding the position in the well plate (string).</span>

<span class="sd">* *sep*: Platform-specific path separator (&quot;/&quot; Unix or &quot;\&quot; Windows)</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">LAYERS_DIR</span> <span class="o">=</span> <span class="s">&#39;{experiment_dir}{sep}layers&#39;</span>
<span class="n">DATA_FILE</span> <span class="o">=</span> <span class="s">&#39;{experiment_dir}{sep}data.h5&#39;</span>

<span class="n">USER_CFG_FILE</span> <span class="o">=</span> <span class="s">&#39;{experiment_dir}{sep}user.cfg&#39;</span>

<span class="n">CYCLE_DIR</span> <span class="o">=</span> <span class="s">&#39;{experiment}-{cycle_id}&#39;</span>
<span class="n">LAYER_NAME</span> <span class="o">=</span> <span class="s">&#39;{cycle}-{channel}&#39;</span>

<span class="n">IMAGE_UPLOAD_DIR</span> <span class="o">=</span> <span class="s">&#39;{cycle_dir}{sep}image_uploads&#39;</span>
<span class="n">ADDITIONAL_UPLOAD_DIR</span> <span class="o">=</span> <span class="s">&#39;{cycle_dir}{sep}additional_uploads&#39;</span>
<span class="n">OME_XML_DIR</span> <span class="o">=</span> <span class="s">&#39;{cycle_dir}{sep}ome_xml&#39;</span>

<span class="n">IMAGE_DIR</span> <span class="o">=</span> <span class="s">&#39;{cycle_dir}{sep}images&#39;</span>
<span class="n">IMAGE_FILE</span> <span class="o">=</span> <span class="s">&#39;{cycle}_{well}_s{site:0&gt;3}_r{row:0&gt;2}_c{column:0&gt;2}_{channel}.png&#39;</span>

<span class="n">METADATA_DIR</span> <span class="o">=</span> <span class="s">&#39;{cycle_dir}{sep}metadata&#39;</span>
<span class="n">IMAGE_METADATA_FILE</span> <span class="o">=</span> <span class="s">&#39;images.metadata&#39;</span>

<span class="n">STATS_DIR</span> <span class="o">=</span> <span class="s">&#39;{cycle_dir}{sep}stats&#39;</span>
<span class="n">STATS_FILE</span> <span class="o">=</span> <span class="s">&#39;{cycle}_{channel}.stat&#39;</span>

<span class="n">SHIFT_DIR</span> <span class="o">=</span> <span class="s">&#39;{cycle_dir}{sep}shifts&#39;</span>
<span class="n">SHIFT_FILE</span> <span class="o">=</span> <span class="s">&#39;{cycle}.shift&#39;</span>
</pre></div>
</div>
<p>Configuration classes then replace the <em>replacement fields</em> in curly braches <code class="docutils literal"><span class="pre">{}</span></code> are replaced with experiment-specific attribute values.</p>
</div>
</div>
<div class="section" id="workflow">
<span id="id4"></span><h2>Workflow<a class="headerlink" href="#workflow" title="Permalink to this headline">¶</a></h2>
<p>The data unit for visualization in <cite>TissueMAPS</cite> is a <strong>Layer</strong>.</p>
<p>The program supports different types of layers and their generation requires multiple steps that are combined into larger workflows.</p>
<p><strong>Channel</strong> layers are comprised of the microscopic raster images. For interactive visualization via the web, images are converted into <a class="reference external" href="http://www.zoomify.com/">zoomify</a> format. These so called <a class="reference external" href="https://en.wikipedia.org/wiki/Pyramid_(image_processing)">pyramids</a> represent a large image by several smaller image tiles (stored in <a class="reference external" href="http://www.jpeg.org">JPEG</a> files) at different resolution levels. Only the tiles that are requested for the current view are loaded and streamed to the client. Channels can be dynamically colorized on the client side and combined by additive color blending for RGB display.</p>
<p><strong>Object</strong> layers represent geometrical structures, such as cell segmentations or wells in a multi-well plate, that are rendered on the client side as vector graphics. The data that specifies the location of objects in the map as well as the corresponding features that describe properties of the objects are stored in <a class="reference external" href="https://www.hdfgroup.org/HDF5/">HDF5</a> files. Objects can be overlaid on channels and colorized according to pre-calculated feature values or results of the program&#8217;s data analysis tools, e.g. class labels generated by a classifier. This allows the user to browse the entire image dataset and perform statistical hypothesis testing in a visually assisted way.</p>
<p>The generation of layers from the microscopic images may involve the following sequence of steps:</p>
<a class="reference internal image-reference" href="_images/TissueMAPS_workflow.png"><img alt="_images/TissueMAPS_workflow.png" src="_images/TissueMAPS_workflow.png" style="height: 500px;" /></a>
<div class="section" id="steps">
<span id="id5"></span><h3>Steps<a class="headerlink" href="#steps" title="Permalink to this headline">¶</a></h3>
<p>Each step of the workflow corresponds to a subpackage of the <cite>tmlib</cite> package:</p>
<ul>
<li><dl class="first docutils">
<dt><a class="reference external" href="../tmlib/metaextract">metaextract</a>: <strong>Extraction of metadata from files</strong></dt>
<dd><p class="first last">Microscopes usually store images together with the acquisition information in vendor-specific formats, which are often not understood by standard readers. The program uses the <a class="reference external" href="https://www.openmicroscopy.org/site/products/bio-formats">Bio-Formats</a> Java library to extract the metadata from heterogeneous image file formats and stores as <a class="reference external" href="https://www.openmicroscopy.org/site/support/ome-model/ome-xml/index.html">XML</a> files according to the standardized <a class="reference external" href="https://www.openmicroscopy.org/site/support/ome-model/">OME</a> data model.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="../tmlib/metaconvert">metaconvert</a>: <strong>Conversion of extracted metadata to custom format</strong></dt>
<dd><p class="first last">For the subsequent steps, the relevant metadata is converted to a custom format and serialized to <a class="reference external" href="http://www.json.org/">JSON</a> files. In particular, the microscope stage positions are used to calculate the relative positions of the images within the scanned acquisition grid, which are ultimately required to stitch individual images together to create an overview of the entire imaged area.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="../tmlib/imextract">imextract</a>: <strong>Extraction of images from files</strong></dt>
<dd><p class="first last">Image files may contain more than one image. Often images acquired at different <em>z</em>-resolutions are stored in the same file. Some microscopes even store all images in a single file. To facilitate easier handling of images, they are extracted from the original files and stored separately as <a class="reference external" href="http://www.libpng.org/pub/png/">PNG</a> files. If images have more than one <em>z</em>-dimensions, they are automatically projected to 2D.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="../tmlib/corilla">corilla</a>: <strong>Calculation of illumination statistics</strong></dt>
<dd><p class="first last">Microscopic images display illumination artifacts. Correction of these artifacts is important for visualization and even more so for quantitative analysis of pixel intensity values. Illumination statistics are pre-calculated across all acquisition sites and stored in <a class="reference external" href="https://www.hdfgroup.org/HDF5/">HDF5</a> files. They can later be applied to individual images in order to correct them for illumination artifacts.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="../tmlib/align">align</a>: <strong>Calculation of shift statistics</strong></dt>
<dd><p class="first last">Images may be acquired at different time points with a potential shift in x-y directions between acquisitions. In order to be able to overlay images from different <em>cycles</em>, images have to be registered and aligned. Shift statistics are pre-calculated for each acquisition site and stored as <a class="reference external" href="http://www.json.org/">JSON</a> files.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="../tmlib/jterator">jterator</a>: <strong>Building and running image analysis pipelines</strong></dt>
<dd><p class="first last">Images are segmented and features are extracted for the detected objects, such as &#8220;nuclei&#8221; or &#8220;cells&#8221;.
Users can build custom image analysis <em>pipelines</em> by combining available modules. The extracted features are stored in <a class="reference external" href="https://www.hdfgroup.org/HDF5/">HDF5</a> files.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="../tmlib/illuminati">illuminati</a>: <strong>Creation of map layers for web visualization</strong></dt>
<dd><p class="first last">Individual images are stitched together to one big overview image according the positional information provided by the obtained metadata. Images are also corrected for illumination artifacts and aligned if necessary based on the calculated illumination and shift statistics, respectively. Segmented objects are given global Ids and their locations within images are translated into global map coordinates. Images are stored as <a class="reference external" href="http://www.jpeg.org">JPEG</a> files and features in <a class="reference external" href="http://www.json.org/">HDF5</a> files.</p>
</dd>
</dl>
</li>
</ul>
<p>The order of steps is not arbitrary, since some steps are dependent on others, i.e. the <em>outputs</em> of one step may be the <em>inputs</em> for another.</p>
</div>
<div class="section" id="command-line-interface">
<span id="id11"></span><h3>Command-line interface<a class="headerlink" href="#command-line-interface" title="Permalink to this headline">¶</a></h3>
<p>Each of the above listed packages provides an application programming interface (<strong>API</strong>) and command-line interface (<strong>CLI</strong>).</p>
<p>The corresponding classes inherit from the <cite>CommandLineInterface</cite> and <cite>ClusterRoutines</cite> base classes. This makes it easy to further extend the workflow by additional steps and allows packages to share a common interface.</p>
<p>Command line calls are handled by <a class="reference external" href="https://docs.python.org/3/library/argparse.html">argparse</a> and follow a general syntax:</p>
<div class="highlight-bash"><div class="highlight"><pre>&lt;class_name&gt; &lt;class_args&gt; &lt;method_name&gt; &lt;method_args&gt;
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><em>class_name</em> is the name of the main parser corresponding to the <em>cli</em> class of an individual step</li>
<li><em>class_args</em> are arguments that are handled by the main parser, such as the logging verbosity level or the path to the directory of the experiment that should be processed, which are used to instantiate the corresponding <em>api</em> class</li>
<li><em>method_name</em> is the name of a subparser corresponding to a method of the <em>cli</em> class</li>
<li><em>method_args</em> are arguments that are handled by the subparser and are forwarded to the methods of the <em>api</em> class</li>
</ul>
<p>You can use the <code class="docutils literal"><span class="pre">-h</span></code> or <code class="docutils literal"><span class="pre">--help</span></code> argument to get help for a particular step:</p>
<div class="highlight-bash"><div class="highlight"><pre>&lt;class_name&gt; --help
</pre></div>
</div>
<p>By default, each step is equipped with the following methods:</p>
<ul class="simple">
<li><strong>init</strong>: initialize a step and create persistent job descriptions</li>
<li><strong>run</strong>: run an individual job on the local machine</li>
<li><strong>submit</strong>: submit all jobs to the cluster and continuously monitor their status</li>
</ul>
<p>Optionally, steps may provide additional methods, such as:</p>
<ul class="simple">
<li><strong>collect</strong>: collect the job output after submission and fuse the data spread across individual files into a single dataset if necessary</li>
<li><strong>apply</strong>: apply the results of the step (calculated statistics) to individual images</li>
</ul>
<p>You can also use the <code class="docutils literal"><span class="pre">-h</span></code> or <code class="docutils literal"><span class="pre">--help</span></code> argument to get help for the individual methods available for a particular step:</p>
<div class="highlight-bash"><div class="highlight"><pre>&lt;class_name&gt; &lt;class_args&gt; &lt;method_name&gt; --help
</pre></div>
</div>
<p>An example for the <cite>metaconvert</cite> step:</p>
<p>The call</p>
<div class="highlight-bash"><div class="highlight"><pre>metaconvert --format cellvoyager ./ init --backup
</pre></div>
</div>
<p>would initialize the <cite>metaconvert</cite> step and create persistent job descriptions on disk, which could subsequently be used to <em>run</em> or <em>submit</em> jobs. It further specifies that the format of files as &#8220;cellvoyager&#8221; and backs up job descriptions and log outputs of the previous submission.</p>
</div>
</div>
<div class="section" id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h2>
<p>We use <a class="reference external" href="http://sphinx-doc.org/index.html">Sphinx</a> in combination with the <a class="reference external" href="https://pypi.python.org/pypi/sphinxcontrib-napoleon">Napoleon extension</a> for support of the <a class="reference external" href="https://github.com/numpy/numpy/blob/master/doc/HOWTO_DOCUMENT.rst.txt#docstring-standard">reStructuredText NumPy style</a>.</p>
<p>To update the documentation upon changes in the source code, do</p>
<div class="code bash highlight-python"><div class="highlight"><pre>$ sphinx-apidoc -o ./docs ./tmlib
</pre></div>
</div>
<p>To build the documentation website, do</p>
<div class="code bash highlight-python"><div class="highlight"><pre>$ cd docs
$ make html
</pre></div>
</div>
<p>The generated HTML files are located at <cite>docs/_build/html</cite>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/tmaps_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Introduction</a><ul>
<li><a class="reference internal" href="#file-system-configuration">File system configuration</a><ul>
<li><a class="reference internal" href="#config-file">Config file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#workflow">Workflow</a><ul>
<li><a class="reference internal" href="#steps">Steps</a></li>
<li><a class="reference internal" href="#command-line-interface">Command-line interface</a></li>
</ul>
</li>
<li><a class="reference internal" href="#documentation">Documentation</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Welcome to the documentation for the TissueMAPS Library!</a></li>
      <li>Next: <a href="installation.html" title="next chapter">Installation</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/introduction.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Markus D. Herrmann, Robin Hafen.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
      |
      <a href="_sources/introduction.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>