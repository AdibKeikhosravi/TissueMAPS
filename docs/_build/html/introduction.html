<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Introduction &mdash; TissueMAPS Library 0.1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="_static/tmaps_favicon.ico"/>
    <link rel="top" title="TissueMAPS Library 0.1.0 documentation" href="index.html" />
    <link rel="next" title="Installation" href="installation.html" />
    <link rel="prev" title="Welcome to the documentation for the TissueMAPS Library!" href="index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="introduction">
<span id="id1"></span><h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<span id="id2"></span><h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p><cite>TissueMAPS</cite> is a web-based, cluster-integrated tool for visualizing and analyzing large-scale microscopic image datasets.</p>
<p>Microscopy image datasets can easily amount to several terabytes, which makes it impractical to store and process them on a local computer. Instead, images  are often stored on a remote data volume and processed by cluster computing.</p>
<p><cite>TissueMAPS</cite> runs on a virtual machine (<em>VM</em>) within a cloud, where it has access to a shared files system and a cluster computing infrastructure. Users interact with the program via the Internet.</p>
<a class="reference internal image-reference" href="_images/TissueMAPS_overview.png"><img alt="_images/TissueMAPS_overview.png" src="_images/TissueMAPS_overview.png" style="height: 400px;" /></a>
<p>The web-based approach has the advantage that large datasets can be handled efficiently and conveniently from a remote computer via a standard web browser.</p>
<p>On the server side, <cite>TissueMAPS</cite> uses Python as a glue language and the <cite>tmlib</cite> Python package serves as a library for tasks related to image storage and processing. The library has an object-orientated design and provides classes for file system operations and interaction with the computer cluster.</p>
</div>
<div class="section" id="file-system-configuration">
<span id="id3"></span><h2>File system configuration<a class="headerlink" href="#file-system-configuration" title="Permalink to this headline">¶</a></h2>
<p>The organizational unit of <cite>TissueMAPS</cite> is an <strong>Experiment</strong>, which is represented by a directory on disk that holds the microscopic image files and related files for metadata, calculated statistics or extracted features.</p>
<div class="section" id="user-configuration-settings">
<span id="id4"></span><h3>User configuration settings<a class="headerlink" href="#user-configuration-settings" title="Permalink to this headline">¶</a></h3>
<p>The location of files on disk can be configure via an experiment-specific user configuration file in <a class="reference external" href="http://yaml.org/">YAML</a> format.</p>
<p>By default, all files belonging to an experiment are stored within the root experiment folder. However, a user can overwrite these default locations.</p>
</div>
</div>
<div class="section" id="workflow">
<span id="id5"></span><h2>Workflow<a class="headerlink" href="#workflow" title="Permalink to this headline">¶</a></h2>
<p>The data unit for visualization of images and the corresponding features is a <strong>Layer</strong>. <cite>TissueMAPS</cite> supports two types of layers and their generation requires different image processing steps:</p>
<p><strong>Channel</strong> layers are comprised of the actual microscopic raster images. For interactive visualization via the web, images are converted into <a class="reference external" href="http://www.zoomify.com/">zoomify</a> format. These so called <a class="reference external" href="https://en.wikipedia.org/wiki/Pyramid_(image_processing)">pyramids</a> represent a large image by several smaller image tiles (stored in <a class="reference external" href="http://www.jpeg.org">JPEG</a> files) at different resolution levels. Only the tiles that are required for the current view are loaded and streamed to the client.</p>
<p><strong>Object</strong> layers represent geometrical structures, such as cell segmentations or wells in a multi-well plate. They are rendered on the client side as vector graphics. The data that specifies the location of objects in the map as well as the corresponding features that describe properties of the objects are stored in <a class="reference external" href="https://www.hdfgroup.org/HDF5/">HDF5</a> files.</p>
<p>The generation of these layers from the microscopic images generally involves different processing <strong>stages</strong>, each of which is composed of a sequence of individual <strong>steps</strong>:</p>
<a class="reference internal image-reference" href="_images/TissueMAPS_workflow.png"><img alt="_images/TissueMAPS_workflow.png" src="_images/TissueMAPS_workflow.png" style="height: 400px;" /></a>
<div class="section" id="steps">
<span id="id6"></span><h3>Steps<a class="headerlink" href="#steps" title="Permalink to this headline">¶</a></h3>
<p>Each <em>step</em> of a workflow <em>stage</em> corresponds to a subpackage of the <cite>tmlib</cite> package:</p>
<ul>
<li><dl class="first docutils">
<dt><a class="reference external" href="tmlib.metaextract.html">metaextract</a>: <strong>Extraction of metadata from microscope files</strong></dt>
<dd><p class="first last">Microscopes usually store images together with additional acquisition information in vendor-specific formats. These are often not understood by standard readers. The <a class="reference external" href="https://www.openmicroscopy.org/site/products/bio-formats">Bio-Formats</a> Java library is used to extract the metadata from heterogeneous image file formats. These are stored as <a class="reference external" href="https://www.openmicroscopy.org/site/support/ome-model/ome-xml/index.html">OMEXML</a> files according to the standardized <a class="reference external" href="https://www.openmicroscopy.org/site/support/ome-model/">OME</a> data model.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="tmlib.metaconfig.html">metaconfig</a>: <strong>Configuration and Complementation of metadata</strong></dt>
<dd><p class="first last">The information that can be retrieved from individual image files is often not sufficient for automated processing in subsequent steps. In particular, information about the position of images within the scanned grid, which is required to stitch individual images together for the creation of an overview of the entire acquisition area, may not be available from image files, but rather needs to be provided by additional microscope-specific metadata files or user input. Metadata from these various resources is combined into a single <em>OMEXML</em> per image acquisition.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="../tmlib/imextract">imextract</a>: <strong>Extraction of images from files</strong></dt>
<dd><p class="first last">Image files may contain more than one image. For example, images acquired at different <em>z</em>-resolutions are often stored in the same file. Some microscopes even store all images in a single file.
These formats are not practical, because they require specialized readers. In addition, it is desirable to apply image compression to save storage space. To these ends, each 2D plate is extracted from the original file and stored in a separate <a class="reference external" href="http://www.libpng.org/pub/png/">PNG</a> file. Optionally, images acquired at different <em>z</em>-resolutions (<em>z</em>-stacks) are projected to 2D. Note that mapping from source to target files is already created in the <cite>metaconfig</cite> step.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="../tmlib/corilla">corilla</a>: <strong>Calculation of illumination statistics</strong></dt>
<dd><p class="first last">Microscopic images generally display illumination artifacts. Correction of these artifacts is important for visualization and even more so for quantitative analysis of pixel intensity values. Illumination statistics are pre-calculated across all acquisition sites and stored in <a class="reference external" href="https://www.hdfgroup.org/HDF5/">HDF5</a> files. They can later be applied to individual images for correction.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="../tmlib/align">align</a>: <strong>Image registration and alignment</strong></dt>
<dd><p class="first last">Images may be acquired at different time points with a potential shift in x-y directions between acquisitions. In order to be able to overlay images from different <em>cycles</em>, images have to be registered and aligned. Shift statistics are pre-calculated for each acquisition site and stored as <a class="reference external" href="http://www.json.org/">JSON</a> files.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="../tmlib/jterator">jterator</a>: <strong>Image segmentation and feature extraction</strong></dt>
<dd><p class="first last">Biologically meaningful objects (e.g. &#8220;cells&#8221;) are detected in the images by segmentation and features can be extracted for the detected objects.
To this end, users can build custom image analysis <em>pipelines</em> by combining available modules in a <a class="reference external" href="http://cellprofiler.org/">CellProfiler</a> like web interface. The outlines of segmented objects and the extracted features are stored in <a class="reference external" href="https://www.hdfgroup.org/HDF5/">HDF5</a> files.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="../tmlib/illuminati">illuminati</a>: <strong>Creation of image pyramids</strong></dt>
<dd><p class="first last">Individual images are stitched together to one big overview image according the positional information provided by the obtained metadata. Images are also corrected for illumination artifacts and aligned if necessary based on the calculated illumination and shift statistics, respectively. Segmented objects get global IDs assigned and their locations within images are translated into global map coordinates. Channel images are stored in <a class="reference external" href="http://www.jpeg.org">JPEG</a>.</p>
</dd>
</dl>
</li>
</ul>
<p>Programmatically, each step is represented by <a class="reference external" href="http://gc3pie.readthedocs.org/en/latest/programmers/api/gc3libs/workflow.html#gc3libs.workflow.SequentialTaskCollection">GC3Pie tasks</a>, which can combined into larger automated workflows. Individual steps are added to the workflow dynamically at runtime, but the steps can be configured in advance via the configuration settings file. To this end, the user needs to provide the required arguments for each step and can overwrite default settings for optional arguments.</p>
</div>
<div class="section" id="command-line-interface">
<span id="id10"></span><h3>Command-line interface<a class="headerlink" href="#command-line-interface" title="Permalink to this headline">¶</a></h3>
<p>Each of the above listed packages contains the following modules, which provide an application programming interface (<strong>API</strong>) and a command-line interface (<strong>CLI</strong>):</p>
<ul class="simple">
<li><strong>argparser</strong>: Serves an instance of class <a class="reference external" href="https://docs.python.org/3/library/argparse.html#argumentparser-objects">argparse.ArgumentParser</a> that processes command line arguments and parses them to the <em>cli</em> class. The parser has the same name as the package and each subparser has a corresponding method in the <em>cli</em> class.</li>
<li><strong>cli</strong>: The <em>cli</em> class gets initialized with the parsed arguments and the method with the name of the specified subparser gets called. The method in turn initializes an instance of the <em>api</em> class and delegates the actual processing to lower level methods of this class. Of particular importance for the workflow is the <em>init</em> method, which handles arguments for fine-tuning of the step and creates persistent job descriptions on disk.</li>
<li><strong>api</strong>: The <em>api</em> class provides methods for all <em>GC3Pie</em> related magic, such as creation and submission of jobs.</li>
</ul>
<p>The <em>api</em> and <em>cli</em> classes inherit from the <cite>CommandLineInterface</cite> and <cite>ClusterRoutines</cite> base classes, respectively. This approach makes it easy to further extend the workflow by additional steps and allows a common syntax for command line calls:</p>
<div class="highlight-bash"><div class="highlight"><pre>&lt;class_name&gt; &lt;class_args&gt; &lt;method_name&gt; &lt;method_args&gt;
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><strong>class_name</strong> is the name of the main parser corresponding to the <em>cli</em> class of an individual step</li>
<li><strong>class_args</strong> are arguments that are handled by the main parser, such as the logging verbosity level or the path to the directory of the experiment that should be processed, which are used to instantiate the corresponding <em>api</em> class</li>
<li><strong>method_name</strong> is the name of a subparser corresponding to a method of the <em>cli</em> class</li>
<li><strong>method_args</strong> are arguments that are handled by the subparser and are forwarded to the methods of the <em>api</em> class</li>
</ul>
<p>The <code class="docutils literal"><span class="pre">-h</span></code> or <code class="docutils literal"><span class="pre">--help</span></code> argument can be used to get help for a particular step:</p>
<div class="highlight-bash"><div class="highlight"><pre>&lt;class_name&gt; --help
</pre></div>
</div>
<p>It can also be used to get help for individual methods available for a particular step:</p>
<div class="highlight-bash"><div class="highlight"><pre>&lt;class_name&gt; &lt;class_args&gt; &lt;method_name&gt; --help
</pre></div>
</div>
<p>By default, each step is equipped with the following methods:</p>
<ul class="simple">
<li><strong>init</strong>: initialize a step and create persistent job descriptions</li>
<li><strong>run</strong>: run an individual job on the local machine</li>
<li><strong>submit</strong>: submit all jobs to the cluster and continuously monitor their status</li>
</ul>
<p>Optionally, steps may provide additional methods, such as:</p>
<ul class="simple">
<li><strong>collect</strong>: collect the job output of parallel runs and fuse the data spread across individual files into a single dataset if necessary</li>
<li><strong>apply</strong>: apply statistics calculated by the step to individual images</li>
</ul>
<p>Here is an example call for the <cite>metaconvert</cite> step:</p>
<div class="highlight-bash"><div class="highlight"><pre>metaconfig -v ./ init --format cellvoyager
</pre></div>
</div>
<p>would initialize the <cite>metaconfig</cite> step and create persistent job descriptions on disk, which could subsequently be used to <em>run</em> or <em>submit</em> jobs. It further specifies a custom file format and thereby adapts the behavior of the program.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/tmaps_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Introduction</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#file-system-configuration">File system configuration</a><ul>
<li><a class="reference internal" href="#user-configuration-settings">User configuration settings</a></li>
</ul>
</li>
<li><a class="reference internal" href="#workflow">Workflow</a><ul>
<li><a class="reference internal" href="#steps">Steps</a></li>
<li><a class="reference internal" href="#command-line-interface">Command-line interface</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Welcome to the documentation for the TissueMAPS Library!</a></li>
      <li>Next: <a href="installation.html" title="next chapter">Installation</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/introduction.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Markus D. Herrmann, Robin Hafen.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
      |
      <a href="_sources/introduction.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>