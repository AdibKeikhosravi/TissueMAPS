#!/usr/bin/env python
import sys
import argparse

import tmlib.models

# Don't trash the user with long tracebacks
sys.tracebacklimit = 0


def add_user(username, password, email):
    # TODO: authentication
    with tmlib.models.utils.Session() as session:
        user = tmlib.models.User(name=username, password=password, email=email)
        session.add(user)


if __name__ == '__main__':

    parser = argparse.ArgumentParser(
        description='''
            Add a new user to the TissueMAPS database.
        '''
    )
    parser.add_argument(
        '-u', '--user_name', required=True, type=str,
        help='user name'
    )
    parser.add_argument(
        '--password', required=True, type=str,
        help='password'
    )
    parser.add_argument(
        '--email', required=True, type=str,
        help='email address'
    )

    args = parser.parse_args()

    add_user(args.user_name, args.password, args.email)
