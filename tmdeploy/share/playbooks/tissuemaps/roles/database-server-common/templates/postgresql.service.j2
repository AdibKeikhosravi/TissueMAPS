# systemd service for PostgreSQL clusters

[Unit]
Description=Citus PostgreSQL Cluster {{ postgresql_version }}-{{ db_node }}
ConditionPathExists={{ db_data_directory }}/{{ postgresql_version }}/{{ db_node }}/postgresql.conf

[Service]
Type=forking
User={{ db_superuser }}
Group={{ db_superuser }}
ExecStart={{ db_executable_directory }}/pg_ctl start -W -o "-p {{ db_port }}" -D {{ db_data_directory }}/{{ postgresql_version }}/{{ db_node }} -l {{ db_log_directory }}/postgresql-{{ postgresql_version }}-{{ db_node }}.log
ExecStop={{ db_executable_directory }}/pg_ctl stop -m smart -o "-p {{ db_port }}" -D {{ db_data_directory }}/{{ postgresql_version }}/{{ db_node }}
ExecReload={{ db_executable_directory }}/pg_ctl reload -D {{ db_data_directory }}/{{ postgresql_version }}/{{ db_node }}
PIDFile={{ db_data_directory }}/{{ postgresql_version }}/{{ db_node }}/postmaster.pid
SyslogIdentifier=postgresql@{{ postgresql_version }}-{{ db_node }}
# prevent OOM killer from choosing the postmaster (individual backends will
# reset the score to 0)
OOMScoreAdjust=-900
KillMode=mixed
KillSignal=SIGINT
TimeoutSec=0

[Install]
WantedBy=multi-user.target
