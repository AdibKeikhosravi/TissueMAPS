<form ng-init="step = stepCtrl.step">

  <h3>{{step.fullname}}</h3>

  <p>{{step.help}}</p>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h4>Batch arguments</h4>
      Arguments that control how data is partitioned into computational jobs.
    </div>
    <div class="panel-body">
      <tm-argument-input arg="arg"
          ng-repeat="arg in stepCtrl.workflow.stages[stepCtrl.currentStageIndex].steps[stepCtrl.currentStepIndex].batch_args"
          arg-collection="setupCtrl.args[stage.name][step.name].batch_args"></tm-argument-input>
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h4>Submission arguments</h4>
      Arguments that control how computational jobs are submitted to the cluster.
      <p>
        <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
        <i>Danger zone - hopefully, you know what you are doing!</i>
      </p>
    </div>
    <div class="panel-body">
      <tm-argument-input arg="arg"
          ng-repeat="arg in stepCtrl.workflow.stages[stepCtrl.currentStageIndex].steps[stepCtrl.currentStepIndex].submission_args"
          arg-collection="setupCtrl.args[stage.name][step.name].submission_args"></tm-argument-input>
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h4>Extra arguments</h4>
    </div>
    <div class="panel-body">
      <tm-argument-input arg="arg"
          ng-repeat="arg in stepCtrl.workflow.stages[stepCtrl.currentStageIndex].steps[stepCtrl.currentStepIndex].extra_args"
          arg-collection="setupCtrl.args[stage.name][step.name].extra_args"></tm-argument-input>

      <div ng-show="stage.name == 'image_analysis'">
        <button class="btn btn-default"
            ng-click="setupCtrl.editPipeline(step)"
            ng-disabled="!setupCtrl.canModifyPipeline()">
          <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
          Edit
        </button>
        <button class="btn btn-default"
            ng-click="setupCtrl.deletePipeline(step)"
            ng-disabled="!setupCtrl.canModifyPipeline()">
          <i class="fa fa-trash-o" aria-hidden="true"></i>
          Delete
        </button>
        <button class="btn btn-default"
            ng-click="setupCtrl.createPipeline()"
            ng-disabled="!setupCtrl.canModifyPipeline()">
          Create new
        </button>
      </div>

    </div>
  </div>

</form>
